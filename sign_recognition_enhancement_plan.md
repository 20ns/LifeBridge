# Sign Language Recognition Enhancement Plan (Revised)

This plan outlines a strategy to improve the accuracy and reliability of the sign language recognition feature in the LifeBridge application. It involves a parallel investigation of the existing local rule-based detection and the machine learning (ML) model path, keeping AWS free-tier constraints in mind.

## Phase 1: Combined Investigation (Local Rules & ML Model)

*   **Goal:** Concurrently address critical local detection issues and investigate the ML model's status and potential.
*   **Track 1: Local Rule-Based Detection Enhancement**
    *   **Sub-Goal:** Resolve the "Emergency" vs. "Yes" misclassification and improve local rule reliability.
    *   **Activities:**
        1.  **Detailed Analysis of Misclassification:** Log and analyze landmark data generated by MediaPipe for "fist" gestures and "thumbs-up" gestures in various conditions. Identify the specific conditions in `frontend/src/components/SignLanguageDetector.tsx` (specifically the `analyzeGesture()` function) that lead to the "Emergency" vs. "Yes" confusion. Pay close attention to `isThumbExtended()` and finger curl detection logic.
        2.  **Refine Local Gesture Logic:** Modify the conditions for "Emergency" to be more robust (e.g., ensure all fingertips are close to the palm or below certain MCP joints). Adjust the "Thumbs Up" logic to be more distinct from a fist. Consider adding more geometric constraints (angles, relative distances between key landmarks) for other gestures if simple up/down checks are insufficient.
        3.  **Local Rules Testing:** Thoroughly test the refined local rules with various hand shapes and orientations.
*   **Track 2: ML Model Path Investigation**
    *   **Sub-Goal:** Understand why the Python ML model (presumably deployed to `ML_GESTURE_API_ENDPOINT` via `lambda_gesture_recognition.py`) was causing "0% confidence issues" and assess its potential.
    *   **Activities:**
        1.  **Enable ML Backend Call (Controlled Test):** In `frontend/src/hooks/useSignLanguageDetection.ts`, temporarily modify `recognizeGestureML()` to call the `ML_GESTURE_API_ENDPOINT`. Implement comprehensive logging for the request payload (landmarks sent) and the response received from the Lambda.
        2.  **Backend Lambda Investigation:** Examine AWS CloudWatch logs for the `gesture-recognition-ml` Lambda function to identify errors or behavior leading to low confidence scores. Verify that all necessary dependencies (NumPy, joblib, scikit-learn, as seen in `backend/src/python/gesture_recognition.py` or `lambda_gesture_recognition.py`) are correctly packaged and available in the Lambda environment. Confirm the model (`model.joblib` from S3 bucket specified in `sagemaker_setup_info.json`) is loading correctly. Test the Lambda function directly (e.g., via AWS console) with sample landmark data captured from the frontend to isolate backend issues.
        3.  **Feature and Model Review:** Compare the feature extraction logic in `lambda_gesture_recognition.py` (`extract_features_from_landmarks`) with the training script `infrastructure/train_medical_gestures.py` (`extract_hand_features`). Ensure consistency. Evaluate if the synthetic data used for training (`infrastructure/train_medical_gestures.py`) is representative enough or if it's a primary cause of poor real-world performance.

## Phase 2: Strategy Definition

*   **Goal:** Based on findings from Phase 1, decide on the optimal path for achieving high accuracy.
*   **Activities:**
    1.  **Comparative Analysis:** Compare the accuracy and reliability of the improved local rules (from Phase 1, Track 1) against the (potentially fixed or understood) ML model (from Phase 1, Track 2).
    2.  **Decision Making:**
        *   **Option A: Enhance Local Rules Further:** If the ML model path proves too problematic or resource-intensive (considering free-tier limits for retraining/hosting if SageMaker endpoints were needed beyond Lambda), focus on making the local rule-based system even more sophisticated.
        *   **Option B: Pursue ML Model Integration:** If the ML model shows promise and issues are rectifiable within reasonable effort and AWS free-tier constraints (e.g., Lambda for inference is fine, SageMaker for occasional retraining on t2/t3.medium instances):
            *   Fix bugs in the Lambda or data pipeline.
            *   Consider if retraining/fine-tuning the model with a small, targeted set of real-world gesture data is necessary and feasible.
        *   **Option C: Hybrid Approach:** Implement a system where local rules handle simple/clear gestures, and the ML model is invoked for more complex gestures or as a secondary validation, or based on an initial confidence score from local rules.

## Phase 3: Implementation, Testing, and Refinement

*   **Goal:** Implement the chosen strategy from Phase 2 and ensure the system is robust and accurate.
*   **Activities:**
    1.  **Development:** Implement the necessary code changes in the frontend (`frontend/src/components/SignLanguageDetector.tsx`, `frontend/src/hooks/useSignLanguageDetection.ts`) and/or backend (Lambda function, potentially model retraining scripts).
    2.  **Integration:** Ensure seamless data flow and error handling between frontend and backend if the ML path is chosen.
    3.  **Comprehensive Testing:**
        *   Test with diverse users, lighting conditions, and backgrounds.
        *   Focus on the specific gestures outlined by the user (Emergency, Help, Pain, etc.).
        *   Validate against the "Tip: Hold gestures steady for 2-3 seconds" for improved detection.
    4.  **Performance Monitoring:** Ensure the solution is performant and meets user experience expectations.
    5.  **Documentation:** Update any relevant documentation (e.g., `docs/ENHANCED_SIGN_LANGUAGE_IMPLEMENTATION_COMPLETE.md`) to reflect the final architecture and decision process.

## Investigation Flow Diagram

```mermaid
graph TD
    A[Camera Input] --> B(MediaPipe Hands);
    B --> C[Hand Landmarks];

    subgraph "Track 1: Local Rule Analysis (SignLanguageDetector.tsx)"
        C --> D{Local Rule-Based Analysis};
        D -- Gesture + Confidence (Local) --> E[Local Analysis Results];
    end

    subgraph "Track 2: ML Path Investigation"
        C --> F(Send Landmarks to ML API);
        F --> G{AWS API Gateway};
        G --> H{Lambda: gesture_recognition.py};
        H --> I[S3: model.joblib];
        H -- Gesture + Confidence (ML) --> J[ML Analysis Results];
    end

    subgraph "Strategy & Integration"
        E --> K{Decision Logic (Compare Local & ML)};
        J --> K;
        K -- Final Sign --> L[Update UI / VisualFeedbackSystem];
        K -- Action --> M[onSignDetected Callback];
    end